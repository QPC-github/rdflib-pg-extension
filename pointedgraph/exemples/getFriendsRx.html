<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="http://code.jquery.com/jquery-1.11.0.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/q.js/0.9.2/q.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.10/rx.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.10/rx.async.js"></script>
    <script src="../../releases/0.1.0/rdflib-stample-0.1.0.js"></script>
    <script src="../../releases/0.1.0/rdflib-stample-pg-extension-0.1.0.js"></script>
</head>
<body>

<script>
    var FOAF = $rdf.Namespace("http://xmlns.com/foaf/0.1/");

    $rdf.Fetcher.fetcherWithPromiseCrossSiteProxyTemplate = "https://www.stample.io/srv/cors?url=";
    //$rdf.Fetcher.fetcherWithPromiseCrossSiteProxyTemplate = "http://data.fm/proxy?uri=";

    var fetcherTimeout = 3000;
    var store = $rdf.PG.createNewStore(fetcherTimeout);
    var henryFoafProfileUrl = "http://bblfish.net/people/henry/card#me";

    store.fetcher.fetch(henryFoafProfileUrl)
            .then(function(henryPg) {
                printFriendName(henryPg);
            })
            .fail(function(fetchError) {
                console.warn("Can't fetch the pointed graph at",henryFoafProfileUrl,fetchError);
            });

    function printFriendName(personPg) {
        personPg.jumpRelObservable( FOAF("knows") )
                .flatMap(function(remoteFriendPg) {
                    return Rx.Observable.fromArray( remoteFriendPg.rel(FOAF("name")) );
                })
                .subscribe(function(remoteFriendPgName) {
                    var friendName = remoteFriendPgName.pointer.toString();
                    $("#friendList").append("<li>"+friendName+"</li>")
                });
    }

</script>

<div>
    <ul id="friendList">

    </ul>
</div>


</body>
</html>